var __hasProp={}.hasOwnProperty;!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){var t,i,n,s;e.fn.check=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!0)})},e.fn.uncheck=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!1)})},e.fn.semicheck=function(){return this.each(function(){return e(this).prop("indeterminate",!0).prop("checked",!1)})},e.fn.togglecheck=function(){return this.each(function(){var t;return t=e(this),t.prop("checked",!t.prop("checked"))})},n={data:[],ajax:!1,url:"./",requestSettings:{},responseHandler:function(e){return e},animationSpeed:400,hideFiles:!1,fileNodeName:"name",folderNodeName:"name",fileNodeTitle:"name",folderNodeTitle:"name",nodeFormatter:function(e){return e},columnView:!1,dblclickDelay:200,classes:{arrow:"glyphicon glyphicon-chevron-right"},checkboxes:!1,hierarchialCheck:!0},t=function(){function t(t,i){this.element=t,this.VERSION="0.2.0",this.settings=e.extend({},n,i),this._defaults=n,this._clicks=0,this._timer=null,this.settings.checkboxes=this.settings.columnView?!1:void 0,this._init()}return t.prototype.open=function(t){var i;return i=e(t).closest("li"),i.hasClass("folder")?(this._openFolder(i),this):!1},t.prototype.close=function(t){var i;return i=e(t).closest("li"),i.hasClass("folder")?(this._closeFolder(i),this):!1},t.prototype.toggle=function(t){var i;return this.settings.columnView||(i=e(t).closest("li"),i.hasClass("is-collapsed")?this._openFolder(i):i.hasClass("is-expanded")&&this._closeFolder(i)),this},t.prototype.select=function(t){return this._selectItem(e(t).closest("li")),this.settings.checkboxes&&e(t).siblings("input[type=checkbox]").togglecheck().change(),this},t.prototype.getSelectedNodes=function(){return this.settings.checkboxes&&e(this.element).find("input[type=checkbox]:checked").map(function(t,i){return e(i).siblings("a")}).get(),!1},t.prototype.getActivePath=function(){var t;return t=this.settings.columnView?e(this.element).find(".active"):e(this.element).find(".active > a").parentsUntil(this.element,"li.folder"),t=t.map(function(t,i){return e(i).find("> a").text()}).get(),this.settings.columnView||t.reverse(),t.join("/")},t.prototype.expandTo=function(t){var i,n,s,r,l,o,a,c;if(t=t.trim("/").split("/"),i=e(this.element),this.settings.columnView)for(i=i.find("> .list-group-wrapper"),r=l=0,a=t.length;a>l;r=++l){if(n=t[r],s=i.find("> .columns").eq(r).find("> ul.list-group > li.folder > a").filter(function(){return e(this).text()===n}),s.length<1)throw new Error("The folder "+n+" does not exists");this.open(s.eq(0))}else for(this.collapseAll(!0),r=o=0,c=t.length;c>o;r=++o){if(n=t[r],i=i.find("> ul.list-group > li.folder").filter(function(){return e(this).find("> a").text()===n}),i.length<1)throw new Error("The folder "+n+" does not exists");this._openFolder(i),this._selectItem(i)}return this},t.prototype.expandAll=function(t){var i;return this.settings.columnView||(i=this,t&&(this.settings._animationSpeed=this.settings.animationSpeed,this.settings.animationSpeed=0),e(this.element).find("li.folder.is-collapsed > a").each(function(e,t){return i.open(t)}),t&&(this.settings.animationSpeed=this.settings._animationSpeed,delete this.settings._animationSpeed)),this},t.prototype.collapseAll=function(t){var i;return this.settings.columnView||(i=this,t&&(this.settings._animationSpeed=this.settings.animationSpeed,this.settings.animationSpeed=0),e(this.element).find("li.folder.is-expanded > a").each(function(e,t){return i.close(t)}),t&&(this.settings.animationSpeed=this.settings._animationSpeed,delete this.settings._animationSpeed)),this},t.prototype.search=function(t){var i;return t=t.toLowerCase(),i=this,e(this.element).find("li").each(function(n,s){var r,l;r=e(s),l=i._data[n].indexOf(t)<0,l?r.hasClass("folder")&&r.find("> ul > li").length>0?r.children("li").removeClass("is-hidden"):r.addClass("is-hidden"):r.removeClass("is-hidden")}),this},t.prototype.destroy=function(){return $this.data("$.filetree")&&$this.data("$.filetree",null),e(this.element).off().empty(),this},t.prototype._init=function(){var t,i,n,s;return t=e(this.element).addClass("file-tree"),i=e(document.createElement("span")).insertAfter(e(this.element)),e(this.element).detach(),this.settings.columnView&&(t.addClass("file-tree-columns"),t=e(document.createElement("div")).addClass("list-group-wrapper").appendTo(t)),n=this.settings.data,s=this,this.settings.ajax?e.ajax(this.settings.url,this.settings.requestSettings).then(function(e){return e=s.settings.responseHandler(e),s._createTree.call(s,t,e)}):e.isArray(n)&&n.length>0?this._createTree.call(this,t,n):this._parseTree.call(this,t),this._addListeners(),e(this.element).insertBefore(i),i.remove(),this._data=e.makeArray(t.find("li").map(function(t,i){return e(i).text().toLowerCase()})),n=null,this.element},t.prototype._createTree=function(t,i){var n,s,r,l,o,a,c,d,h,p,u,f,m,g,y,v,_,k;for(n=e(t),f=[],m=[],g=0,v=i.length;v>g;g++)a=i[g],"folder"===a.type&&m.push(a),"file"===a.type&&f.push(a);for(f.sort(this._nameSort),m.sort(this._nameSort),i=m.concat(f),p=e(document.createElement("ul")).addClass("list-group"),y=0,_=i.length;_>y;y++)if(c=i[y],"file"!==c.type||this.settings.hideFiles!==!0){h=e(document.createElement("li")).addClass(""+c.type+" list-group-item"),s=e(document.createElement("a")).attr("href","#"),["file","folder"].indexOf(c.type)>-1?s.attr("title",c[this.settings[""+c.type+"NodeTitle"]]).html(c[this.settings[""+c.type+"NodeName"]]):s.attr("title",c.name).html(c.name);for(d in c)__hasProp.call(c,d)&&(u=c[d],"children"!==d&&s.data(d,u));this.settings.columnView&&"folder"===c.type&&(r=e(document.createElement("span")).addClass("arrow "+this.settings.classes.arrow),s.append(r)),h.append(s),this.settings.multiselect&&(l=e(document.createElement("input")).attr("type","checkbox"),c.readOnly&&(l.prop("disabled",!0),h.addClass("is-read-only")),h.prepend(l)),"folder"===c.type&&(h.addClass("is-collapsed"),("undefined"===c.children||c.children.length<1)&&h.addClass("is-empty"),this.settings.columnView||(r=e(document.createElement("button")).addClass("arrow "+this.settings.classes.arrow),h.prepend(r)),this.settings.hideFiles&&(k=e.grep(c.children,function(e){return"folder"===e.type}),k.length>0&&h.removeClass("is-collapsed").addClass("is-empty")),e.isArray(c.children)&&this._createTree.call(this,h,c.children)),h=this.settings.nodeFormatter.call(null,h),p.append(h)}return this.settings.columnView?(o=e(document.createElement("div")).addClass("columns"),o.append(p),n.append(o)):n.append(p)},t.prototype._openFolder=function(t){var i,n,s,r,l,o,a;i=t.find("> a"),s=e(this.element),n=t.find(this.settings.columnView?"> .columns":"> ul"),o=this,l=e.Event("folder.open.filetree"),r=e.Event("folder.opened.filetree"),s.trigger(l),this.settings.columnView?(a=s.find(".list-group-wrapper").eq(0),this._selectItem(t),n.find("> ul > li").length>0?n.clone(!0).appendTo(a):a.append('<div class="columns empty"><p>empty folder</p></div>'),s.trigger(r)):n.slideDown(o.settings.animationSpeed,function(){return t.removeClass("is-collapsed").addClass("is-expanded"),n.removeAttr("style"),s.trigger(r)})},t.prototype._closeFolder=function(t){var i,n,s,r,l,o;i=t.find("> a"),n=this.settings.columnView?t.closest(".columns"):t.find("> ul"),o=this,s=e(this.element),l=e.Event("folder.close.filetree"),r=e.Event("folder.closed.filetree"),s.trigger(l),this.settings.columnView?(n.nextAll(".columns").remove(),s.trigger(r)):n.slideUp(o.settings.animationSpeed,function(){t.removeClass("is-expanded").addClass("is-collapsed"),n.removeAttr("style"),s.trigger(r)})},t.prototype._selectItem=function(t){var i;return i=this.settings.columnView?t.closest(".columns"):e(this.element),i.find("li.active").removeClass("active"),this.settings.columnView&&this._closeFolder(t),t.addClass("active")},t.prototype._triggerClickEvent=function(t){var i,n,s,r,l;n=e(this.element),l=this,this._clicks++,i=e(t.target),r=i.closest("li").hasClass("folder")?"folder":"file",s=i.data(),1===this._clicks?this._timer=setTimeout(function(){l._clicks=0,i.trigger(""+r+".click.filetree",s)},l.settings.dblclickDelay):(clearTimeout(this._timer),i.trigger(""+r+".dblclick.filetree",s),this._clicks=0),t.preventDefault()},t.prototype._addListeners=function(){var t,i;t=e(this.element),i=this,t.on("click","li.folder > a, li.file > a",this._triggerClickEvent.bind(this)),this.settings.columnView||t.on("click","li.folder.is-collapsed > button.arrow",function(t){i._openFolder(e(t.target).closest("li")),t.stopImmediatePropagation()}).on("click","li.folder.is-expanded > button.arrow",function(t){i._closeFolder(e(t.target).closest("li")),t.stopImmediatePropagation()}),this.settings.multiselect&&this.settings.hierarchialCheck&&t.on("change","input[type=checkbox]:not([disabled])",function(i){var n,s;n=e(i.target).closest("li"),n.hasClass("folder")&&!n.hasClass("is-empty")&&(s=n.find("> input[type=checkbox]:not([disabled])").prop("checked"),n.find("> ul").find("input[type=checkbox]:not([disabled])").prop("checked",s).prop("indeterminate",!1)),n.parentsUntil(t,"li.folder").each(function(){var t,i,n,s;return t=e(this),n=t.find("> ul").find("input[type=checkbox]:not([disabled])"),s=t.find("> input[type=checkbox]:not([disabled])"),i=t.find("> ul").find("input[type=checkbox]:not([disabled]):checked"),i.length>0?(s.semicheck(),i.length===n.length?s.check():void 0):s.uncheck()}),i.stopImmediatePropagation()})},t.prototype._parseTree=function(t){var i,n,s,r,l,o,a,c,d,h,p,u,f;for(i=e(t),n=e(document.createElement("span")).insertAfter(i),i.detach(),a=i.find("> li"),h=0,u=a.length;u>h;h++){if(o=a[h],d=e(o).find("> ul"),l=e(d).find("> li"),l.length>0||e(o).hasClass("folder"))for(s=e(document.createElement("button")).addClass("arrow"),e(o).addClass("folder has-children is-collapsed").prepend(s),p=0,f=d.length;f>p;p++)c=d[p],this._parseTree(c);else e(o).addClass("file");"list"===this.settings.style&&this.settings.multiselect===!0&&(r=e(document.createElement("input")).attr("type","checkbox"),e(o).prepend(r))}return i.find("li > a[data-type=folder]").closest("li").addClass("folder").removeClass("file"),i.insertBefore(n),n.remove()},t.prototype._nameSort=function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0},t}(),i=function(i,n){var s;return s=this,this.each(function(){var r,l;r=e(this),l=r.data("$.filetree"),l||r.data("$.filetree",l=new t(this,i)),"string"==typeof i&&"_"!==i.substr(0,1)&&(s=l[i].call(l,n))}),s},s=e.fn.filetree,e.fn.filetree=i,e.fn.filetree.Constructor=t,e.fn.filetree.noConflict=function(){return e.fn.filetree=s,this}});