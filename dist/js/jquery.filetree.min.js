!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){var t,n,i,r,o;e.fn.check=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!0)})},e.fn.uncheck=function(){return this.each(function(){return e(this).prop("indeterminate",!1).prop("checked",!1)})},e.fn.semicheck=function(){return this.each(function(){return e(this).prop("indeterminate",!0).prop("checked",!1)})},e.fn.togglecheck=function(){return this.each(function(){var t;return t=e(this),t.prop("checked",!t.prop("checked"))})},i={data:[],animationSpeed:400,folderTrigger:"click",multiselect:!1,hideFiles:!1,fileContainer:null,fileNodeName:"name",folderNodeName:"name",fileNodeTitle:"name",folderNodeTitle:"name",nodeFormatter:function(e){return e},ajax:!1,url:"./",requestSettings:{},responseHandler:function(e){return e}},r=Array.prototype.map,t=function(){function t(t,n){this.element=t,this.settings=e.extend({},i,n),this._defaults=i,this.init()}return t.prototype.init=function(){var t,n,i;return t=this._getRootElement(e(this.element)),n=this.settings.data,i=this,this.settings.ajax===!0?e.ajax(this.settings.url,this.settings.requestSettings).then(function(e){return e=i.settings.responseHandler(e),i._createTree.call(i,t,e)}):e.isArray(n)&&n.length>0?this._createTree.call(this,t,n):this._parseTree.call(this,t),this._addListeners(),n=null,t},t.prototype.open=function(e){return this._openFolder(e)},t.prototype.close=function(e){return this._closeFolder(e)},t.prototype.toggle=function(t){var n;return n=e(t).closest("li"),n.hasClass("is-collapsed")?this._openFolder(t):n.hasClass("is-expanded")?this._closeFolder(t):void 0},t.prototype.select=function(t){return e(this.element).find("li.is-selected").removeClass("is-selected"),e(t).closest("li").addClass("is-selected"),this.settings.multiselect===!0?e(t).siblings("input[type=checkbox]").togglecheck().change():void 0},t.prototype.getSelected=function(){return this.settings.multiselect===!0?e(this.element).find("input[type=checkbox]:checked").map(function(){return e(this).siblings("a")}).get():void 0},t.prototype.destroy=function(){return e(this.element).off().empty()},t.prototype._getRootElement=function(t){return"ul"===e(t).prop("tagName").toLowerCase()?e(t).addClass("filetree"):e(t).find("ul").length>0?e(t).find("ul").eq(0).addClass("filetree"):e(document.createElement("ul")).addClass("filetree").appendTo(e(t))},t.prototype._createTree=function(t,n){var i,r,o,l,s,a,c,d,f,p,u,h,m,g,y,k,C;for(i=e(t),u=[],h=[],m=0,y=n.length;y>m;m++)s=n[m],"folder"===s.type&&h.push(s),"file"===s.type&&u.push(s);for(u.sort(this._nameSort),h.sort(this._nameSort),n=h.concat(u),f="ul"===i.prop("tagName").toLowerCase()?i:e(document.createElement("ul")),g=0,k=n.length;k>g;g++){a=n[g],d=e(document.createElement("li")).addClass(a.type),"file"===a.type&&this.settings.hideFiles===!0&&d.addClass("is-hidden"),r=e(document.createElement("a")).attr("href","#"),"file"===a.type?r.attr("title",a[this.settings.fileNodeTitle]).html(a[this.settings.fileNodeName]):"folder"===a.type&&r.attr("title",a[this.settings.folderNodeTitle]).html(a[this.settings.folderNodeName]);for(c in a)p=a[c],a.hasOwnProperty(c)&&"children"!==c&&r.data(c,p);r=this.settings.nodeFormatter.call(null,r),this.settings.multiselect===!0&&(l=e(document.createElement("input")).attr("type","checkbox"),d.append(l)),d.append(r),f.append(d),"folder"===a.type&&"undefined"!=typeof a.children&&a.children.length>0&&(d.addClass("is-collapsed").addClass("has-children"),o=e(document.createElement("button")).addClass("arrow"),d.prepend(o),this.settings.hideFiles===!0&&(C=e.grep(a.children,function(e){return"folder"===e.type}),C.length>0&&(d.removeClass("is-collapsed").removeClass("has-children"),d.find("button").removeClass("arrow").addClass("no-arrow"))),this._createTree.call(this,d,a.children))}return i.append(f)},t.prototype._openFolder=function(t){var n,i,r,o,l,s;return i=e(t).closest("li"),i.hasClass("folder")?(n=i.find("a").eq(0),r=i.find("ul").eq(0),s=this,l=e.Event("open.folder.filetree"),o=e.Event("opened.folder.filetree"),n.trigger(l),r.slideDown(s.settings.animationSpeed,function(){return i.removeClass("is-collapsed").addClass("is-expanded"),r.removeAttr("style"),n.trigger(o)})):!1},t.prototype._closeFolder=function(t){var n,i,r,o,l,s;return i=e(t).closest("li"),i.hasClass("folder")?(n=i.find("a").eq(0),r=i.find("ul").eq(0),s=this,l=e.Event("close.folder.filetree"),o=e.Event("closed.folder.filetree"),n.trigger(l),r.slideUp(s.settings.animationSpeed,function(){return i.removeClass("is-expanded").addClass("is-collapsed"),r.removeAttr("style"),n.trigger(o)})):!1},t.prototype._triggerClickEvent=function(t){var n,i,o,l,s;return n=e(this),i=e(this.element),l=e.Event(t,{bubbles:!1}),o=n.data(),"undefined"==typeof o.path&&(s=n.parentsUntil(i,"li").clone().children("ul,button").remove().end(),o.path=r.call(s,function(e){return e.innerText}).reverse().join("/")),n.trigger(l,o)},t.prototype._addListeners=function(){var t,n;t=e(this.element),n=this,t.on("click","li.folder.is-collapsed.has-children > button.arrow",function(e){return n._openFolder(this),e.stopImmediatePropagation()}),t.on("click","li.folder.is-expanded.has-children > button.arrow",function(e){return n._closeFolder(this),e.stopImmediatePropagation()}),t.on("click","li.folder > a",function(e){return n._triggerClickEvent.call(this,"click.folder.filetree"),e.stopImmediatePropagation()}),t.on("click","li.file > a",function(e){return n._triggerClickEvent.call(this,"click.file.filetree"),e.stopImmediatePropagation()}),t.on("click","li.file, li.folder",function(e){return e.stopImmediatePropagation()}),t.on("click",function(e){return e.stopImmediatePropagation()}),t.on("dblclick","li.folder > a",function(e){return n._triggerClickEvent.call(this,"dblclick.folder.filetree"),e.stopImmediatePropagation()}),t.on("dblclick","li.file > a",function(e){return n._triggerClickEvent.call(this,"dblclick.file.filetree"),e.stopImmediatePropagation()}),this.settings.multiselect===!0&&t.on("change","input[type=checkbox]",function(n){var i,r;return i=e(n.target).closest("li"),i.hasClass("folder")&&i.hasClass("has-children")&&(r=i.find("> input[type=checkbox]").prop("checked"),i.find("> ul").find("input[type=checkbox]").prop("checked",r).prop("indeterminate",!1)),i.parentsUntil(t,"li.folder").each(function(){var t,n,i,r;return t=e(this),i=t.find("> ul").find("input[type=checkbox]"),r=t.find("> input[type=checkbox]"),n=t.find("> ul").find("input[type=checkbox]:checked"),n.length>0?(r.semicheck(),n.length===i.length?r.check():void 0):r.uncheck()}),n.stopImmediatePropagation()})},t.prototype._parseTree=function(t){var n,i,r,o,l,s,a,c,d,f,p;for(n=e(t),l=n.find("> li"),c=0,f=l.length;f>c;c++)if(o=l[c],a=e(o).find("> ul"),r=e(a).find("> li"),r.length>0)for(i=e(document.createElement("button")).addClass("arrow"),e(o).addClass("folder has-children is-collapsed").prepend(i),d=0,p=a.length;p>d;d++)s=a[d],this._parseTree(s);else e(o).addClass("file");return n.find("li > a[data-type=folder]").closest("li").addClass("folder").removeClass("file")},t.prototype._nameSort=function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0},t}(),n=function(n,i){var r;return r=this,this.each(function(){var o,l;o=e(this),l=o.data("$.filetree"),l||o.data("$.filetree",l=new t(this,n)),"string"==typeof n&&"_"!==n.substr(0,1)&&(r=l[n].call(l,i))}),r},o=e.fn.filetree,e.fn.filetree=n,e.fn.filetree.Constructor=t,e.fn.filetree.noConflict=function(){return e.fn.filetree=o,this}});