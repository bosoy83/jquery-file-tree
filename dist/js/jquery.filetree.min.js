!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){var t,i,n,r,l;n={data:[],animationSpeed:400,folderTrigger:"click",hideFiles:!1,fileContainer:null,fileNodeName:"name",folderNodeName:"name",fileNodeTitle:"name",folderNodeTitle:"name",ajax:!1,url:"./",requestSettings:{}},r=Array.prototype.map,t=function(){function t(t,i){this.element=t,this.settings=e.extend({},n,i),this._defaults=n,this.init()}return t.prototype.init=function(){var t,i,n;return t=this._getRootElement(e(this.element)),i=this.settings.data,n=this,this.settings.ajax===!0?e.ajax(this.settings.url,this.settings.requestSettings).then(function(e){return n._createTree.call(n,t,e)}):e.isArray(i)&&i.length>0?this._createTree.call(this,t,i):this._parseTree.call(this,t),this._addListeners(),i=null,t},t.prototype.open=function(e){return this._openFolder(e)},t.prototype.close=function(e){return this._closeFolder(e)},t.prototype.toggle=function(t){var i;return i=e(t).closest("li"),i.hasClass("is-collapsed")?this._openFolder(t):i.hasClass("is-expanded")?this._closeFolder(t):void 0},t.prototype.select=function(t){return e(this.element).find("li.is-selected").removeClass("is-selected"),e(t).closest("li").addClass("is-selected")},t.prototype.destroy=function(){return e(this.element).off().empty()},t.prototype._getRootElement=function(t){return"ul"===e(t).prop("tagName").toLowerCase()?e(t).addClass("filetree"):e(t).find("ul").length>0?e(t).find("ul").eq(0).addClass("filetree"):e(document.createElement("ul")).addClass("filetree").appendTo(e(t))},t.prototype._createTree=function(t,i){var n,r,l,o,s,a,d,c,f,p,u,h,m,g,C,y;for(n=e(t),p=[],u=[],h=0,g=i.length;g>h;h++)o=i[h],"folder"===o.type&&u.push(o),"file"===o.type&&p.push(o);for(p.sort(this._nameSort),u.sort(this._nameSort),i=u.concat(p),c="ul"===n.prop("tagName").toLowerCase()?n:e(document.createElement("ul")),m=0,C=i.length;C>m;m++){s=i[m],d=e(document.createElement("li")).addClass(s.type),"file"===s.type&&this.settings.hideFiles===!0&&d.addClass("is-hidden"),r=e(document.createElement("a")).attr("href","#"),"file"===s.type?r.attr("title",s[this.settings.fileNodeTitle]).html(s[this.settings.fileNodeName]):"folder"===s.type&&r.attr("title",s[this.settings.folderNodeTitle]).html(s[this.settings.folderNodeName]);for(a in s)f=s[a],s.hasOwnProperty(a)&&"children"!==a&&r.data(a,f);d.append(r),c.append(d),"folder"===s.type&&"undefined"!=typeof s.children&&s.children.length>0&&(d.addClass("is-collapsed").addClass("has-children"),l=e(document.createElement("button")).addClass("arrow"),d.prepend(l),this.settings.hideFiles===!0&&(y=e.grep(s.children,function(e){return"folder"===e.type}),y.length>0&&(d.removeClass("is-collapsed").removeClass("has-children"),d.find("button").removeClass("arrow").addClass("no-arrow"))),this._createTree.call(this,d,s.children))}return n.append(c)},t.prototype._openFolder=function(t){var i,n,r,l,o,s;return n=e(t).closest("li"),n.hasClass("folder")?(i=n.find("a").eq(0),r=n.find("ul").eq(0),s=this,o=e.Event("open.folder.filetree"),l=e.Event("opened.folder.filetree"),i.trigger(o),r.slideDown(s.settings.animationSpeed,function(){return n.removeClass("is-collapsed").addClass("is-expanded"),r.removeAttr("style"),i.trigger(l)})):!1},t.prototype._closeFolder=function(t){var i,n,r,l,o,s;return n=e(t).closest("li"),n.hasClass("folder")?(i=n.find("a").eq(0),r=n.find("ul").eq(0),s=this,o=e.Event("close.folder.filetree"),l=e.Event("closed.folder.filetree"),i.trigger(o),r.slideUp(s.settings.animationSpeed,function(){return n.removeClass("is-expanded").addClass("is-collapsed"),r.removeAttr("style"),i.trigger(l)})):!1},t.prototype._triggerClickEvent=function(t){var i,n,l,o,s;return i=e(this),n=e(this.element),o=e.Event(t,{bubbles:!1}),l=i.data(),"undefined"==typeof l.path&&(s=i.parentsUntil(n,"li").clone().children("ul,button").remove().end(),l.path=r.call(s,function(e){return e.innerText}).reverse().join("/")),i.trigger(o,l)},t.prototype._addListeners=function(){var t,i;t=e(this.element),i=this,t.on("click","li.folder.is-collapsed.has-children > button.arrow",function(e){return i._openFolder(this),e.stopImmediatePropagation()}),t.on("click","li.folder.is-expanded.has-children > button.arrow",function(e){return i._closeFolder(this),e.stopImmediatePropagation()}),t.on("click","li.folder > a",function(e){return i._triggerClickEvent.call(this,"click.folder.filetree"),e.stopImmediatePropagation()}),t.on("click","li.file > a",function(e){return i._triggerClickEvent.call(this,"click.file.filetree"),e.stopImmediatePropagation()}),t.on("click","li.file, li.folder",function(e){return e.stopImmediatePropagation()}),t.on("click",function(e){return e.stopImmediatePropagation()}),t.on("dblclick","li.folder > a",function(e){return i._triggerClickEvent.call(this,"dblclick.folder.filetree"),e.stopImmediatePropagation()}),t.on("dblclick","li.file > a",function(e){return i._triggerClickEvent.call(this,"dblclick.file.filetree"),e.stopImmediatePropagation()})},t.prototype._parseTree=function(t){var i,n,r,l,o,s,a,d,c,f,p;for(i=e(t),o=i.find("> li"),d=0,f=o.length;f>d;d++)if(l=o[d],a=e(l).find("> ul"),r=e(a).find("> li"),r.length>0)for(n=e(document.createElement("button")).addClass("arrow"),e(l).addClass("folder has-children is-collapsed").prepend(n),c=0,p=a.length;p>c;c++)s=a[c],this._parseTree(s);else e(l).addClass("file");return i.find("li > a[data-type=folder]").closest("li").addClass("folder").removeClass("file")},t.prototype._nameSort=function(e,t){return e.name.toLowerCase()<t.name.toLowerCase()?-1:e.name.toLowerCase()>t.name.toLowerCase()?1:0},t}(),i=function(i,n){return this.each(function(){var r,l;return r=e(this),l=r.data("$.filetree"),l||r.data("$.filetree",l=new t(this,i)),"string"==typeof i&&"_"!==i.substr(0,1)?l[i].call(l,n):void 0})},l=e.fn.filetree,e.fn.filetree=i,e.fn.filetree.Constructor=t,e.fn.filetree.noConflict=function(){return e.fn.filetree=l,this}});